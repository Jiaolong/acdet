CLASS_NAMES: ['Car', 'Pedestrian', 'Cyclist']

DATA_CONFIG:
    _BASE_CONFIG_: cfgs/dataset_configs/kitti_dataset.yaml
    POINT_CLOUD_RANGE: [0, -39.68, -3, 69.12, 39.68, 1]
    DATA_PROCESSOR:
        - NAME: mask_points_and_boxes_outside_range
          REMOVE_OUTSIDE_BOXES: True

        - NAME: shuffle_points
          SHUFFLE_ENABLED: {
            'train': True,
            'test': False
          }

        - NAME: project_points
          TYPE: 'cylindrical'
          FOV_LEFT: 45.0
          FOV_RIGHT: -45.0
          Z_MIN: -2.5
          Z_MAX: 1.0
          NUM_COLS: 512
          NUM_ROWS: 48
          VOXEL_SIZE: [0.16, 0.16, 4]
          REMOVE_EMPTY_BBOXES: False

    DATA_AUGMENTOR:
        DISABLE_AUG_LIST: ['placeholder']
        AUG_CONFIG_LIST:
            - NAME: gt_sampling
              USE_ROAD_PLANE: True
              DB_INFO_PATH:
                  - kitti_dbinfos_train.pkl
              PREPARE: {
                 filter_by_min_points: ['Car:5', 'Pedestrian:5', 'Cyclist:5'],
                 filter_by_difficulty: [-1],
              }

              SAMPLE_GROUPS: ['Car:15','Pedestrian:15', 'Cyclist:15']
              NUM_POINT_FEATURES: 4
              DATABASE_WITH_FAKELIDAR: False
              REMOVE_EXTRA_WIDTH: [0.0, 0.0, 0.0]
              LIMIT_WHOLE_SCENE: False

            - NAME: random_world_flip
              ALONG_AXIS_LIST: ['x']

            - NAME: random_world_rotation
              WORLD_ROT_ANGLE: [-0.78539816, 0.78539816]

            - NAME: random_world_scaling
              WORLD_SCALE_RANGE: [0.95, 1.05]

MODEL:
    NAME: RangeDet

    BACKBONE_FV:
        NAME: SALSANEXT
        INPUT_CHANNELS: 5
        OUTPUT_CHANNELS: 32
        KERNEL_CFG:
            TYPE: "meta"
            META_CHANNELS: 4
            INPUT_CHANNELS: 32
            OUTPUT_CHANNELS: 32
            FEATURE_MAP_SIZE: [48, 512]
            USE_ATTENTION: True
            USE_MASK: True
            REDUCED: True

    RANGE_TO_BEV:
        NAME: RangeToBEV
        PROJECT_CFG:
            TYPE: 'BEV'
            POINT_CLOUD_RANGE: [0, -39.68, -3, 69.12, 39.68, 1]
            VOXEL_SIZE: [0.16, 0.16, 4]

    BACKBONE_BEV:
        NAME: BaseBEVBackbone
        INPUT_CHANNELS: 32
        LAYER_NUMS: [3, 5, 5]
        LAYER_STRIDES: [2, 2, 2]
        NUM_FILTERS: [64, 128, 256]
        UPSAMPLE_STRIDES: [1, 2, 4]
        NUM_UPSAMPLE_FILTERS: [128, 128, 128]

    DENSE_HEAD:
      NAME: CenterHead
      INPUT_CHANNELS: 384
      CLASS_AGNOSTIC: False
      TASKS: [
        {
          'num_class': 3,
          'class_names': [ 'Car', 'Pedestrian', 'Cyclist' ]
        }
      ]
      COMMON_HEADS: {
        'reg': [ 2, 2 ], 'height': [ 1, 2 ], 'dim': [ 3, 2 ], 'rot': [ 2, 2 ]
      }
      SHARE_CONV_CHANNEL: 64
      TRAIN_CONFIG: {
        'point_cloud_range': [ 0, -39.68, -3, 69.12, 39.68, 1 ],
        'voxel_size': [ 0.16, 0.16, 4 ],
        'out_size_factor': 2,
        'min_radius': [ 2.5 ],
        'post_max_size': 50,
      }
      BBOX_CODER: {
        'point_cloud_range': [ 0, -39.68, -3, 69.12, 39.68, 1 ],
        'post_center_range': [ 0, -39.68, -3, 69.12, 39.68, 1 ],
        'max_num': 100,
        'score_threshold': 0.1,
        'out_size_factor': 2,
        'voxel_size': [ 0.16, 0.16 ],
        'code_size': 8
      }
      SEPARATE_HEAD: {
        'init_bias': -2.19,
        'final_kernel': 3,
        'head_conv': 64,
      }
      LOSS_CONFIG:
        LOSS_WEIGHTS: {
          'cls_weight': 1.0,
          'loc_weight': 2.0,
          'code_weights': [ 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0 ]
        }
    POST_PROCESSING:
      RECALL_THRESH_LIST: [ 0.3, 0.5, 0.7 ]
      EVAL_METRIC: kitti


OPTIMIZATION:
    BATCH_SIZE_PER_GPU: 1
    NUM_EPOCHS: 50

    OPTIMIZER: adam_onecycle
    LR: 0.003
    WEIGHT_DECAY: 0.01
    MOMENTUM: 0.9

    MOMS: [0.95, 0.85]
    PCT_START: 0.4
    DIV_FACTOR: 10
    DECAY_STEP_LIST: [35, 45]
    LR_DECAY: 0.1
    LR_CLIP: 0.0000001

    LR_WARMUP: False
    WARMUP_EPOCH: 1

    GRAD_NORM_CLIP: 10
